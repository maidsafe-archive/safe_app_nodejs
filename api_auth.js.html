

<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      api/auth.js - Documentation
  </title>

  <link href="https://www.braintreepayments.com/images/favicon-ccda0b14.png" rel="icon" type="image/png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  
  <link type="text/css" rel="stylesheet" href="styles/collapse.css">
  

  

  <!-- start Mixpanel -->
  <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("1919205b2da72e4da3b9b6639b444d59");</script>
  <!-- end Mixpanel -->
</head>

<body>
  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <div class="top-nav-wrapper">
    <ul>
      <li >
        <a href="index.html">
          
            <svg fill="#6D6D6D" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          
          
        </a>
      </li>

      

    </ul>
  </div>

  <nav>
    <h3 class="reference-title">
      SAFE Network Node.js Client Library
    </h3>

    
      <h3>
        Resources
      </h3>
      
        <a href="https://github.com/maidsafe/safe_app_nodejs">Github Repo</a>
      
        <a href=""> | </a>
      
        <a href="https://forum.safedev.org/">Dev Forum</a>
      
    

    <h3>Classes</h3><ul><li id="AuthInterface-nav"><a href="AuthInterface.html">AuthInterface</a><ul class='methods'><li data-type="method" id="AuthInterface-canAccessContainer-nav"><a href="AuthInterface.html#canAccessContainer">canAccessContainer</a></li><li data-type="method" id="AuthInterface-genAuthUri-nav"><a href="AuthInterface.html#genAuthUri">genAuthUri</a></li><li data-type="method" id="AuthInterface-genConnUri-nav"><a href="AuthInterface.html#genConnUri">genConnUri</a></li><li data-type="method" id="AuthInterface-genContainerAuthUri-nav"><a href="AuthInterface.html#genContainerAuthUri">genContainerAuthUri</a></li><li data-type="method" id="AuthInterface-genShareMDataUri-nav"><a href="AuthInterface.html#genShareMDataUri">genShareMDataUri</a></li><li data-type="method" id="AuthInterface-getContainer-nav"><a href="AuthInterface.html#getContainer">getContainer</a></li><li data-type="method" id="AuthInterface-getContainersPermissions-nav"><a href="AuthInterface.html#getContainersPermissions">getContainersPermissions</a></li><li data-type="method" id="AuthInterface-getOwnContainer-nav"><a href="AuthInterface.html#getOwnContainer">getOwnContainer</a></li><li data-type="method" id="AuthInterface-loginForTest-nav"><a href="AuthInterface.html#loginForTest">loginForTest</a></li><li data-type="method" id="AuthInterface-loginFromUri-nav"><a href="AuthInterface.html#loginFromUri">loginFromUri</a></li><li data-type="method" id="AuthInterface-openUri-nav"><a href="AuthInterface.html#openUri">openUri</a></li><li data-type="method" id="AuthInterface-readGrantedPermissions-nav"><a href="AuthInterface.html#readGrantedPermissions">readGrantedPermissions</a></li><li data-type="method" id="AuthInterface-refreshContainersPermissions-nav"><a href="AuthInterface.html#refreshContainersPermissions">refreshContainersPermissions</a></li><li data-type="method" id="AuthInterface-simulateNetworkDisconnect-nav"><a href="AuthInterface.html#simulateNetworkDisconnect">simulateNetworkDisconnect</a></li></ul></li><li id="CipherOptInterface-nav"><a href="CipherOptInterface.html">CipherOptInterface</a><ul class='methods'><li data-type="method" id="CipherOptInterface-newAsymmetric-nav"><a href="CipherOptInterface.html#newAsymmetric">newAsymmetric</a></li><li data-type="method" id="CipherOptInterface-newPlainText-nav"><a href="CipherOptInterface.html#newPlainText">newPlainText</a></li><li data-type="method" id="CipherOptInterface-newSymmetric-nav"><a href="CipherOptInterface.html#newSymmetric">newSymmetric</a></li></ul></li><li id="CryptoInterface-nav"><a href="CryptoInterface.html">CryptoInterface</a><ul class='methods'><li data-type="method" id="CryptoInterface-generateEncKeyPair-nav"><a href="CryptoInterface.html#generateEncKeyPair">generateEncKeyPair</a></li><li data-type="method" id="CryptoInterface-generateEncKeyPairFromRaw-nav"><a href="CryptoInterface.html#generateEncKeyPairFromRaw">generateEncKeyPairFromRaw</a></li><li data-type="method" id="CryptoInterface-generateNonce-nav"><a href="CryptoInterface.html#generateNonce">generateNonce</a></li><li data-type="method" id="CryptoInterface-generateSignKeyPair-nav"><a href="CryptoInterface.html#generateSignKeyPair">generateSignKeyPair</a></li><li data-type="method" id="CryptoInterface-generateSignKeyPairFromRaw-nav"><a href="CryptoInterface.html#generateSignKeyPairFromRaw">generateSignKeyPairFromRaw</a></li><li data-type="method" id="CryptoInterface-getAppPubEncKey-nav"><a href="CryptoInterface.html#getAppPubEncKey">getAppPubEncKey</a></li><li data-type="method" id="CryptoInterface-getAppPubSignKey-nav"><a href="CryptoInterface.html#getAppPubSignKey">getAppPubSignKey</a></li><li data-type="method" id="CryptoInterface-pubEncKeyFromRaw-nav"><a href="CryptoInterface.html#pubEncKeyFromRaw">pubEncKeyFromRaw</a></li><li data-type="method" id="CryptoInterface-pubSignKeyFromRaw-nav"><a href="CryptoInterface.html#pubSignKeyFromRaw">pubSignKeyFromRaw</a></li><li data-type="method" id="CryptoInterface-secEncKeyFromRaw-nav"><a href="CryptoInterface.html#secEncKeyFromRaw">secEncKeyFromRaw</a></li><li data-type="method" id="CryptoInterface-secSignKeyFromRaw-nav"><a href="CryptoInterface.html#secSignKeyFromRaw">secSignKeyFromRaw</a></li><li data-type="method" id="CryptoInterface-sha3Hash-nav"><a href="CryptoInterface.html#sha3Hash">sha3Hash</a></li></ul></li><li id="EncKeyPair-nav"><a href="EncKeyPair.html">EncKeyPair</a><ul class='methods'><li data-type="method" id="EncKeyPair-decryptSealed-nav"><a href="EncKeyPair.html#decryptSealed">decryptSealed</a></li></ul></li><li id="Entries-nav"><a href="Entries.html">Entries</a><ul class='methods'><li data-type="method" id="Entries-get-nav"><a href="Entries.html#get">get</a></li><li data-type="method" id="Entries-insert-nav"><a href="Entries.html#insert">insert</a></li><li data-type="method" id="Entries-len-nav"><a href="Entries.html#len">len</a></li><li data-type="method" id="Entries-listEntries-nav"><a href="Entries.html#listEntries">listEntries</a></li><li data-type="method" id="Entries-mutate-nav"><a href="Entries.html#mutate">mutate</a></li></ul></li><li id="EntryMutationTransaction-nav"><a href="EntryMutationTransaction.html">EntryMutationTransaction</a><ul class='methods'><li data-type="method" id="EntryMutationTransaction-delete-nav"><a href="EntryMutationTransaction.html#delete">delete</a></li><li data-type="method" id="EntryMutationTransaction-insert-nav"><a href="EntryMutationTransaction.html#insert">insert</a></li><li data-type="method" id="EntryMutationTransaction-update-nav"><a href="EntryMutationTransaction.html#update">update</a></li></ul></li><li id="File-nav"><a href="File.html">File</a><ul class='methods'><li data-type="method" id="File-close-nav"><a href="File.html#close">close</a></li><li data-type="method" id="File-read-nav"><a href="File.html#read">read</a></li><li data-type="method" id="File-size-nav"><a href="File.html#size">size</a></li><li data-type="method" id="File-write-nav"><a href="File.html#write">write</a></li></ul></li><li id="ImmutableDataInterface-nav"><a href="ImmutableDataInterface.html">ImmutableDataInterface</a><ul class='methods'><li data-type="method" id="ImmutableDataInterface-create-nav"><a href="ImmutableDataInterface.html#create">create</a></li><li data-type="method" id="ImmutableDataInterface-fetch-nav"><a href="ImmutableDataInterface.html#fetch">fetch</a></li></ul></li><li id="MutableData-nav"><a href="MutableData.html">MutableData</a><ul class='methods'><li data-type="method" id="MutableData-applyEntriesMutation-nav"><a href="MutableData.html#applyEntriesMutation">applyEntriesMutation</a></li><li data-type="method" id="MutableData-decrypt-nav"><a href="MutableData.html#decrypt">decrypt</a></li><li data-type="method" id="MutableData-delUserPermissions-nav"><a href="MutableData.html#delUserPermissions">delUserPermissions</a></li><li data-type="method" id="MutableData-emulateAs-nav"><a href="MutableData.html#emulateAs">emulateAs</a></li><li data-type="method" id="MutableData-encryptKey-nav"><a href="MutableData.html#encryptKey">encryptKey</a></li><li data-type="method" id="MutableData-encryptValue-nav"><a href="MutableData.html#encryptValue">encryptValue</a></li><li data-type="method" id="MutableData-get-nav"><a href="MutableData.html#get">get</a></li><li data-type="method" id="MutableData-getEntries-nav"><a href="MutableData.html#getEntries">getEntries</a></li><li data-type="method" id="MutableData-getKeys-nav"><a href="MutableData.html#getKeys">getKeys</a></li><li data-type="method" id="MutableData-getNameAndTag-nav"><a href="MutableData.html#getNameAndTag">getNameAndTag</a></li><li data-type="method" id="MutableData-getPermissions-nav"><a href="MutableData.html#getPermissions">getPermissions</a></li><li data-type="method" id="MutableData-getSerialisedSize-nav"><a href="MutableData.html#getSerialisedSize">getSerialisedSize</a></li><li data-type="method" id="MutableData-getUserPermissions-nav"><a href="MutableData.html#getUserPermissions">getUserPermissions</a></li><li data-type="method" id="MutableData-getValues-nav"><a href="MutableData.html#getValues">getValues</a></li><li data-type="method" id="MutableData-getVersion-nav"><a href="MutableData.html#getVersion">getVersion</a></li><li data-type="method" id="MutableData-put-nav"><a href="MutableData.html#put">put</a></li><li data-type="method" id="MutableData-quickSetup-nav"><a href="MutableData.html#quickSetup">quickSetup</a></li><li data-type="method" id="MutableData-serialise-nav"><a href="MutableData.html#serialise">serialise</a></li><li data-type="method" id="MutableData-setMetadata-nav"><a href="MutableData.html#setMetadata">setMetadata</a></li><li data-type="method" id="MutableData-setUserPermissions-nav"><a href="MutableData.html#setUserPermissions">setUserPermissions</a></li></ul></li><li id="MutableDataInterface-nav"><a href="MutableDataInterface.html">MutableDataInterface</a><ul class='methods'><li data-type="method" id="MutableDataInterface-fromSerial-nav"><a href="MutableDataInterface.html#fromSerial">fromSerial</a></li><li data-type="method" id="MutableDataInterface-newEntries-nav"><a href="MutableDataInterface.html#newEntries">newEntries</a></li><li data-type="method" id="MutableDataInterface-newMutation-nav"><a href="MutableDataInterface.html#newMutation">newMutation</a></li><li data-type="method" id="MutableDataInterface-newPermissions-nav"><a href="MutableDataInterface.html#newPermissions">newPermissions</a></li><li data-type="method" id="MutableDataInterface-newPrivate-nav"><a href="MutableDataInterface.html#newPrivate">newPrivate</a></li><li data-type="method" id="MutableDataInterface-newPublic-nav"><a href="MutableDataInterface.html#newPublic">newPublic</a></li><li data-type="method" id="MutableDataInterface-newRandomPrivate-nav"><a href="MutableDataInterface.html#newRandomPrivate">newRandomPrivate</a></li><li data-type="method" id="MutableDataInterface-newRandomPublic-nav"><a href="MutableDataInterface.html#newRandomPublic">newRandomPublic</a></li></ul></li><li id="NFS-nav"><a href="NFS.html">NFS</a><ul class='methods'><li data-type="method" id="NFS-create-nav"><a href="NFS.html#create">create</a></li><li data-type="method" id="NFS-delete-nav"><a href="NFS.html#delete">delete</a></li><li data-type="method" id="NFS-fetch-nav"><a href="NFS.html#fetch">fetch</a></li><li data-type="method" id="NFS-insert-nav"><a href="NFS.html#insert">insert</a></li><li data-type="method" id="NFS-open-nav"><a href="NFS.html#open">open</a></li><li data-type="method" id="NFS-update-nav"><a href="NFS.html#update">update</a></li></ul></li><li id="Permissions-nav"><a href="Permissions.html">Permissions</a><ul class='methods'><li data-type="method" id="Permissions-getPermissionSet-nav"><a href="Permissions.html#getPermissionSet">getPermissionSet</a></li><li data-type="method" id="Permissions-insertPermissionSet-nav"><a href="Permissions.html#insertPermissionSet">insertPermissionSet</a></li><li data-type="method" id="Permissions-len-nav"><a href="Permissions.html#len">len</a></li><li data-type="method" id="Permissions-listPermissionSets-nav"><a href="Permissions.html#listPermissionSets">listPermissionSets</a></li></ul></li><li id="PubEncKey-nav"><a href="PubEncKey.html">PubEncKey</a><ul class='methods'><li data-type="method" id="PubEncKey-decrypt-nav"><a href="PubEncKey.html#decrypt">decrypt</a></li><li data-type="method" id="PubEncKey-encrypt-nav"><a href="PubEncKey.html#encrypt">encrypt</a></li><li data-type="method" id="PubEncKey-encryptSealed-nav"><a href="PubEncKey.html#encryptSealed">encryptSealed</a></li><li data-type="method" id="PubEncKey-getRaw-nav"><a href="PubEncKey.html#getRaw">getRaw</a></li></ul></li><li id="PubSignKey-nav"><a href="PubSignKey.html">PubSignKey</a><ul class='methods'><li data-type="method" id="PubSignKey-getRaw-nav"><a href="PubSignKey.html#getRaw">getRaw</a></li><li data-type="method" id="PubSignKey-verify-nav"><a href="PubSignKey.html#verify">verify</a></li></ul></li><li id="RDF-nav"><a href="RDF.html">RDF</a><ul class='methods'><li data-type="method" id="RDF-add-nav"><a href="RDF.html#add">add</a></li><li data-type="method" id="RDF-any-nav"><a href="RDF.html#any">any</a></li><li data-type="method" id="RDF-append-nav"><a href="RDF.html#append">append</a></li><li data-type="method" id="RDF-bnode-nav"><a href="RDF.html#bnode">bnode</a></li><li data-type="method" id="RDF-commit-nav"><a href="RDF.html#commit">commit</a></li><li data-type="method" id="RDF-each-nav"><a href="RDF.html#each">each</a></li><li data-type="method" id="RDF-literal-nav"><a href="RDF.html#literal">literal</a></li><li data-type="method" id="RDF-namespace-nav"><a href="RDF.html#namespace">namespace</a></li><li data-type="method" id="RDF-nowOrWhenFetched-nav"><a href="RDF.html#nowOrWhenFetched">nowOrWhenFetched</a></li><li data-type="method" id="RDF-parse-nav"><a href="RDF.html#parse">parse</a></li><li data-type="method" id="RDF-removeMany-nav"><a href="RDF.html#removeMany">removeMany</a></li><li data-type="method" id="RDF-serialise-nav"><a href="RDF.html#serialise">serialise</a></li><li data-type="method" id="RDF-setId-nav"><a href="RDF.html#setId">setId</a></li><li data-type="method" id="RDF-statementsMatching-nav"><a href="RDF.html#statementsMatching">statementsMatching</a></li><li data-type="method" id="RDF-sym-nav"><a href="RDF.html#sym">sym</a></li></ul></li><li id="Reader-nav"><a href="Reader.html">Reader</a><ul class='methods'><li data-type="method" id="Reader-read-nav"><a href="Reader.html#read">read</a></li><li data-type="method" id="Reader-size-nav"><a href="Reader.html#size">size</a></li></ul></li><li id="SAFEApp-nav"><a href="SAFEApp.html">SAFEApp</a><ul class='methods'><li data-type="method" id="SAFEApp-appIsMock-nav"><a href="SAFEApp.html#appIsMock">appIsMock</a></li><li data-type="method" id="SAFEApp-clearObjectCache-nav"><a href="SAFEApp.html#clearObjectCache">clearObjectCache</a></li><li data-type="method" id="SAFEApp-fetch-nav"><a href="SAFEApp.html#fetch">fetch</a></li><li data-type="method" id="SAFEApp-getAccountInfo-nav"><a href="SAFEApp.html#getAccountInfo">getAccountInfo</a></li><li data-type="method" id="SAFEApp-getOwnContainerName-nav"><a href="SAFEApp.html#getOwnContainerName">getOwnContainerName</a></li><li data-type="method" id="SAFEApp-isNetStateConnected-nav"><a href="SAFEApp.html#isNetStateConnected">isNetStateConnected</a></li><li data-type="method" id="SAFEApp-isNetStateDisconnected-nav"><a href="SAFEApp.html#isNetStateDisconnected">isNetStateDisconnected</a></li><li data-type="method" id="SAFEApp-isNetStateInit-nav"><a href="SAFEApp.html#isNetStateInit">isNetStateInit</a></li><li data-type="method" id="SAFEApp-logPath-nav"><a href="SAFEApp.html#logPath">logPath</a></li><li data-type="method" id="SAFEApp-reconnect-nav"><a href="SAFEApp.html#reconnect">reconnect</a></li><li data-type="method" id="SAFEApp-webFetch-nav"><a href="SAFEApp.html#webFetch">webFetch</a></li></ul></li><li id="SecEncKey-nav"><a href="SecEncKey.html">SecEncKey</a><ul class='methods'><li data-type="method" id="SecEncKey-decrypt-nav"><a href="SecEncKey.html#decrypt">decrypt</a></li><li data-type="method" id="SecEncKey-encrypt-nav"><a href="SecEncKey.html#encrypt">encrypt</a></li><li data-type="method" id="SecEncKey-getRaw-nav"><a href="SecEncKey.html#getRaw">getRaw</a></li></ul></li><li id="SecSignKey-nav"><a href="SecSignKey.html">SecSignKey</a><ul class='methods'><li data-type="method" id="SecSignKey-getRaw-nav"><a href="SecSignKey.html#getRaw">getRaw</a></li><li data-type="method" id="SecSignKey-sign-nav"><a href="SecSignKey.html#sign">sign</a></li></ul></li><li id="SignKeyPair-nav"><a href="SignKeyPair.html">SignKeyPair</a></li><li id="WebID-nav"><a href="WebID.html">WebID</a><ul class='methods'><li data-type="method" id="WebID-create-nav"><a href="WebID.html#create">create</a></li><li data-type="method" id="WebID-fetchContent-nav"><a href="WebID.html#fetchContent">fetchContent</a></li><li data-type="method" id="WebID-init-nav"><a href="WebID.html#init">init</a></li><li data-type="method" id="WebID-serialise-nav"><a href="WebID.html#serialise">serialise</a></li><li data-type="method" id="WebID-update-nav"><a href="WebID.html#update">update</a></li></ul></li><li id="WebInterface-nav"><a href="WebInterface.html">WebInterface</a><ul class='methods'><li data-type="method" id="WebInterface-addPublicNameToDirectory-nav"><a href="WebInterface.html#addPublicNameToDirectory">addPublicNameToDirectory</a></li><li data-type="method" id="WebInterface-addWebIdToDirectory-nav"><a href="WebInterface.html#addWebIdToDirectory">addWebIdToDirectory</a></li><li data-type="method" id="WebInterface-getPublicNames-nav"><a href="WebInterface.html#getPublicNames">getPublicNames</a></li><li data-type="method" id="WebInterface-getVocabs-nav"><a href="WebInterface.html#getVocabs">getVocabs</a></li><li data-type="method" id="WebInterface-getWebIds-nav"><a href="WebInterface.html#getWebIds">getWebIds</a></li><li data-type="method" id="WebInterface-linkServiceToSubname-nav"><a href="WebInterface.html#linkServiceToSubname">linkServiceToSubname</a></li></ul></li><li id="Writer-nav"><a href="Writer.html">Writer</a><ul class='methods'><li data-type="method" id="Writer-close-nav"><a href="Writer.html#close">close</a></li><li data-type="method" id="Writer-write-nav"><a href="Writer.html#write">write</a></li></ul></li></ul><h3 id="global-nav">Global</h3><ul><li><a href="global.html#CONSTANTS">CONSTANTS</a></li><li><a href="global.html#fromAuthUri">fromAuthUri</a></li><li><a href="global.html#initialiseApp">initialiseApp</a></li><li><a href="global.html#VERSION">VERSION</a></li></ul>
  </nav>

  <div id="main">
    
      <h1 class="page-title">
        api/auth.js
      </h1>
    

    
      

<section>
  <article>
    <pre class="prettyprint source linenums"><code>// Copyright 2018 MaidSafe.net limited.
//
// This SAFE Network Software is licensed to you under
// the MIT license &lt;LICENSE-MIT or http://opensource.org/licenses/MIT> or
// the Modified BSD license &lt;LICENSE-BSD or https://opensource.org/licenses/BSD-3-Clause>,
// at your option.
//
// This file may not be copied, modified, or distributed except according to those terms.
//
// Please review the Licences for the specific language governing permissions and limitations
// relating to use of the SAFE Network Software.


const lib = require('../native/lib');
const nativeH = require('../native/helpers');
const types = require('../native/types');
const { useMockByDefault } = require('../helpers');
const { validateShareMDataPermissions } = require('../helpers');
const errConst = require('../error_const');
const makeError = require('../native/_error.js');

const makeAppInfo = nativeH.makeAppInfo;
const makePermissions = nativeH.makePermissions;
const makeShareMDataPermissions = nativeH.makeShareMDataPermissions;

/**
* @private
* Generates the app's URI converting the string into a base64 format, removing
* characters or symbols which are not valid for a URL like '=' sign,
* and making it lower case.
*/
const genAppUri = (str) => {
  const urlSafeBase64 = (Buffer.from(str))
                          .toString('base64')
                          .replace(/\+/g, '-') // Convert '+' to '-'
                          .replace(/\//g, '_') // Convert '/' to '_'
                          .replace(/=+$/, '') // Remove ending '='
                          .toLowerCase();
  return `safe-${urlSafeBase64}`;
};

/**
* @private
* Prefix the URI with safe-auth protocol
*/
const addSafeAuthProtocol = (response) => {
  response.uri = `safe-auth:${response.uri}`; // eslint-disable-line no-param-reassign
  return response;
};

/**
* @private
* Remove 'safe' protocol from URI in order to be able to decode it.
* Also, remove any '/' characters that could have been added after the ':' by
* some OS like Fedora, making the URI invalid for decoding.
* This characters are not added by the authenticator, we therefore
* don't have much choice than just make sure we remove them from here.
*/
const removeSafeProtocol = (uri) => uri.replace(/^safe-[^:]*:?[/]*/g, '');

/**
* Contains all authentication related functionality
*/
class AuthInterface {

  /**
  * @hideconstructor
  */
  constructor(app) {
    this.app = app;
    this._registered = false;
    this.setupUri();
  }

  /**
  * @private
  * Generate the app's URI for the IPC protocol using the app's id
  * and register the URI scheme.
  */
  setupUri() {
    const appInfo = this.app.appInfo;
    const opts = this.app.options;
    let scheme;
    if (opts.registerScheme) {
      scheme = genAppUri(appInfo.id);
    }
    if (opts.joinSchemes &amp;&amp; opts.joinSchemes.length > 0) {
      scheme = scheme ? [scheme].concat(opts.joinSchemes) : opts.joinSchemes;
    }
    if (scheme) {
      lib.registerUriScheme({
        bundle: appInfo.bundle ? appInfo.bundle : appInfo.id,
        vendor: appInfo.vendor,
        name: appInfo.name,
        icon: 'test',
        exec: appInfo.customExecPath }, scheme);
    }
  }

  /**
   * Whether or not this is a registered/authenticated session.
   *
   * @returns {Boolean} true if this is an authenticated session
   * @example
   * // Assumes {@link initialiseApp|SAFEApp} interface has been obtained
   * const isRegistered = app.auth.registered;
   */
  get registered() {
    return this._registered;
  }

  /**
   * Generate an authentication URI for the app with
   * the given permissions and optional parameters.
   *
   * @param {Object} permissions - mapping the container-names
   *                  to a list of permissions you want to
   *                  request
   * @param {Object} opts
   * @param {Boolean} [opts.own_container=false] - whether or not to request
   *    app's own container to be created
   *
   * @returns {Promise&lt;String>} safe-auth URI
   * @example
   * // Assumes {@link initialiseApp|SAFEApp} interface has been obtained
   *
   * const containerPermissions =
   * {
   *   _public: [
   *     'Read',
   *     'Insert',
   *     'Update',
   *     'Delete'
   *   ],
   *   _publicNames: [
   *     'Read',
   *     'Insert',
   *     'Update',
   *     'Delete'
   *   ]
   * };
   * const authorisationOptions = {own_container: true};
   *
   * const asyncFn = async () => {
   *     try {
   *         const authReqUri = await app.auth.genAuthUri(
   *             containerPermissions,
   *             authorisationOptions
   *         );
   *     } catch (err) {
   *         throw err;
   *     }
   * };
   */
  genAuthUri(permissions, opts) {
    const perm = makePermissions(permissions);
    const appInfo = makeAppInfo(this.app.appInfo);
    return lib.encode_auth_req(new types.AuthReq({
      app: appInfo,
      app_container: !!(opts &amp;&amp; opts.own_container),
      containers: perm,
      containers_len: perm.length,
      containers_cap: perm.length
    }).ref())
    .then(addSafeAuthProtocol);
  }

  /**
   * Generate a safe-auth URI to request permissions on arbitrary owned MutableData's.
   * Necessary when an authorised app needs access to a MutableData that was created by
   * another application and is also owned by current account.
   *
   * @param {Object} permissions - mapping the MutableData's XoR names
   *                  to a list of permissions you want to request
   *
   * @returns {Promise&lt;String>} safe-auth URI
   * @example
   * // Assumes {@link initialiseApp|SAFEApp} interface has been obtained
   *
   * const permissions = [
   *   {
   *     typeTag: 15001,
   *     name: mutableDataXorName,
   *     perms: ['Insert']
   *   }
   * ];
   *
   * const asyncFn = async () => {
   *     try {
   *         const shareMDataReqUri = await app.auth.genShareMDataUri(permissions);
   *     } catch (err) {
   *         throw err;
   *     }
   * };
   */
  genShareMDataUri(permissions) {
    validateShareMDataPermissions(permissions);
    const mdatasPerms = makeShareMDataPermissions(permissions);
    const appInfo = makeAppInfo(this.app.appInfo);
    return lib.encode_share_mdata_req(new types.ShareMDataReq({
      app: appInfo,
      mdata: mdatasPerms,
      mdata_len: mdatasPerms.length
    }).ref())
    .then(addSafeAuthProtocol);
  }

  /**
   * Generate an unregistered connection URI for the app,
   * especially for simply browsing and reading data on the network.
   *
   * @returns {Promise&lt;String>} safe-auth URI
   * @example
   * // Assumes {@link initialiseApp|SAFEApp} interface has been obtained
   * const asyncFn = async () => {
   *     const app = await safe.initialiseApp(appInfo);
   *     try {
   *         const unRegisteredUri = await app.auth.genConnUri();
   *     } catch (err) {
   *         throw err;
   *     }
   * };
   */
  genConnUri() { // eslint-disable-line class-methods-use-this
    return lib.encode_unregistered_req(this.app.appInfo.id)
      .then(addSafeAuthProtocol);
  }

  /**
   * Opens URI with system, using respective registered application.
   * @param {String} uri Authententication
   * @returns &lt;Promise>
   * @example
   * // Assumes {@link initialiseApp|SAFEApp} interface has been obtained
   * const asyncFn = async () => {
   *     const app = await safe.initialiseApp(appInfo);
   *     try {
   *         await app.auth.openUri('safe://shouldOpenSafeBrowser');
   *     } catch (err) {
   *         throw err;
   *     }
   * };
   */
  openUri(uri) { // eslint-disable-line class-methods-use-this
    return lib.openUri(uri);
  }

  /**
   * Generate a safe-auth URI to request further container permissions.
   *
   * @param {Object} containers mapping container name to list of permissions
   * @returns {Promise&lt;String>} safe-auth URI
   * @example
   * // Assumes {@link initialiseApp|SAFEApp} interface has been obtained
   * const containerPermissions =
   * {
   *   _videos: [
   *     'Insert'
   *   ]
   * };
   *
   * const asyncFn = async () => {
   *     try {
   *         const contReqUri = await app.auth.genContainerAuthUri(containerPermissions);
   *     } catch (err) {
   *         throw err;
   *     }
   * };
   */
  genContainerAuthUri(containers) {
    const ctnrs = makePermissions(containers);
    const appInfo = makeAppInfo(this.app.appInfo);
    return lib.encode_containers_req(new types.ContainerReq({
      app: appInfo,
      containers: ctnrs,
      containers_len: ctnrs.length,
      containers_cap: ctnrs.length
    }).ref())
    .then(addSafeAuthProtocol);
  }

  /**
   * Refresh the access persmissions from the network. Useful when you just
   * connected or received a response from the authenticator in the IPC protocol.
   * @return {Promise}
   * @example
   * // Assumes {@link initialiseApp|SAFEApp} interface has been obtained
   * const permissions = {
   *     _public: ['Read', 'Insert', 'Update', 'Delete', 'ManagePermissions']
   * };
   *
   * const asyncFn = async () => {
   *     try {
   *         const authReqUri = await app.auth.genAuthUri(permissions, {});
   *         let authUri = await safe.authorise(authReqUri);
   *         await app.auth.refreshContainersPermissions();
   *         const mData = await app.auth.getContainer('_public');
   *         let permsObject = await app.auth.getContainersPermissions();
   *
   *         console.log(permsObject);
   *
   *         const updatePermissions = {
   *           _publicNames: ['Read', 'Insert', 'Update', 'Delete', 'ManagePermissions']
   *         }
   *         let contReqUri = await app.auth.genContainerAuthUri(updatePermissions);
   *         authUri = await safe.authorise(contReqUri);
   *
   *         console.log(permsObject);
   *
   *         await app.auth.refreshContainersPermissions();
   *         permsObject = await app.auth.getContainersPermissions();
   *
   *         console.log(permsObject);
   *     } catch (err) {
   *        throw err;
   *     }
   * };
   */
  refreshContainersPermissions() {
    return lib.access_container_refresh_access_info(this.app.connection);
  }

  /**
   * Get the names of all containers found and the app's granted
   * permissions for each of them.
   *
   * @returns {Promise&lt;Array>}
   * @example
   * // Assumes {@link initialiseApp|SAFEApp} interface has been obtained
   * const asyncFn = async () => {
   *     try {
   *         const containerPermissions = await app.auth.getContainersPermissions();
   *     } catch (err) {
   *         throw err;
   *     }
   * };
   */
  getContainersPermissions() {
    return lib.access_container_fetch(this.app.connection);
  }

  /**
   * Read granted containers permissions from an auth URI
   * without the need to connect to the network.
   *
   * This function appears redundant to app.auth.getContainersPermissions, however the difference
   * is that readGrantedPermissions doesn't require an authorised app connection.
   *
   * @param {String} uri the IPC response string given
   * @throws {NON_AUTH_GRANTED_URI}
   * @returns {Promise&lt;Array>}
   * @example
   * // Assumes {@link initialiseApp|SAFEApp} interface has been obtained
   * const asyncFn = async () => {
   *     try {
   *         const authReqUri = await app.auth.genAuthUri({});
   *         await app.auth.openUri(authReqUri);
   *         const containerPermissions = await app.auth.readGrantedPermissions(
   *             &lt; returned auth URI from openUri >
   *         );
   *     } catch (err) {
   *         throw err;
   *     }
   * };
   */
  readGrantedPermissions(uri) { // eslint-disable-line class-methods-use-this
    const sanitisedUri = removeSafeProtocol(uri);

    return lib.decode_ipc_msg(sanitisedUri)
      .then((resp) => {
        if (resp[0] !== 'granted') {
          throw makeError(errConst.NON_AUTH_GRANTED_URI.code, errConst.NON_AUTH_GRANTED_URI.msg);
        }
        const authGranted = resp[1];
        const contsPerms = {};
        authGranted.access_container_entry.forEach((cont) => {
          contsPerms[cont.name] = {
            Read: cont.permissions.Read,
            Insert: cont.permissions.Insert,
            Update: cont.permissions.Update,
            Delete: cont.permissions.Delete,
            ManagePermissions: cont.permissions.ManagePermissions
          };
        });
        return contsPerms;
      }).catch((err) => Promise.reject(err));
  }

  /**
  * Get the MutableData for the app's root container.
  * When run in tests, this falls back to the randomly generated version
  * @returns {Promise&lt;MutableData>}
   * @example
   * // Assumes {@link initialiseApp|SAFEApp} interface has been obtained
   * const asyncFn = async () => {
   *     try {
   *         const authReqUri = await app.auth.genAuthUri({}, { own_container: true });
   *         await app.auth.openUri(authReqUri);
   *         // After URI is opened by SAFE Authenticator and authorised,
   *         // this snippet assumes that your application has an
   *         // IPC strategy to receive returned authorisation URI.
   *         await app.auth.loginFromUri(authUri);
   *         const mutableDataInterface = await app.auth.getOwnContainer();
   *     } catch (err) {
   *         throw err;
   *     }
   * };
  */
  getOwnContainer() {
    return this.app.getOwnContainerName()
      .then((containerName) => this.getContainer(containerName));
  }

  /**
   * Whether or not this session has specifc access permission for a given container.
   * @param {String} name  name of the container, e.g. `'_public'`
   * @param {(String|Array&lt;String>)} [permissions=['Read']] permissions to check for
   * @returns {Promise&lt;Boolean>}
   * @example
   * // Assumes {@link initialiseApp|SAFEApp} interface has been obtained
   *
   * const containerPermissions =
   * {
   *   _public: ['Read']
   * };
   *
   * const asyncFn = async () => {
   *     try {
   *         const authReqUri = await app.auth.genAuthUri(
   *           containerPermissions
   *         );
   *         await app.auth.openUri(authReqUri);
   *         // After URI is opened by SAFE Authenticator and authorised,
   *         // this snippet assumes that your application has an
   *         // IPC strategy to receive returned authorisation uri.
   *         await app.auth.loginFromUri(authUri);
   *         const container = '_public';
   *         const permissions = ['Read'];
   *         const canAccessContainer = await app.auth.canAccessContainer(container, permissions);
   *     } catch (err) {
   *         throw err;
   *     }
   * };
   */
  canAccessContainer(name, permissions) {
    let perms = ['Read'];
    if (permissions) {
      if (typeof permissions === 'string') {
        perms = [permissions];
      } else {
        perms = permissions;
      }
    }

    return this.getContainersPermissions()
      .then((containersPerms) => {
        const contPerms = containersPerms[name];
        const result = perms.every((perm) => contPerms[perm]);
        return Promise.resolve(result);
      });
  }

  /**
   * Get interface to MutableData underlying account container.
   * @param name {String} name of the container, e.g. `'_public'`
   * @throws {MISSING_CONTAINER_STRING}
   * @returns {Promise&lt;MutableData>}
   * @example
   * // Assumes {@link initialiseApp|SAFEApp} interface has been obtained
   *
   * const containerPermissions =
   * {
   *   _public: ['Read', 'Insert', 'Update']
   * };
   *
   * const asyncFn = async () => {
   *   try {
   *     const app = await safe.initialiseApp(appInfo);
   *     const authReqUri = await app.auth.genAuthUri(containerPermissions);
   *     await app.auth.openUri(authReqUri);
   *     // After URI is opened by SAFE Authenticator and authorised,
   *     // this snippet assumes that your application has an
   *     // IPC strategy to receive returned authorisation uri.
   *     await app.auth.loginFromUri(authUri);
   *     const app = await safe.initialiseApp(appInfo);
   *     const authReqUri = await app.auth.genAuthUri(
   *       containerPermissions
   *     );
   *     const container = '_public';
   *     const mutableDataInterface = await app.auth.getContainer(container);
   *   } catch (err) {
   *     throw err;
   *   };
   * };
   */
  getContainer(name) {
    if (!name) {
      throw makeError(errConst.MISSING_CONTAINER_STRING.code,
                      errConst.MISSING_CONTAINER_STRING.msg);
    }
    return lib.access_container_get_container_mdata_info(this.app.connection, name)
      .then((data) => this.app.mutableData.wrapMdata(data));
  }

  /**
   * Create a new authenticated or unregistered network session
   * using the provided IPC response from SAFE Authenticator.
   * @param {String} uri the IPC response string given
   * @throws {MISSING_AUTH_URI}
   * @returns {Promise&lt;SAFEApp>}
   * @example
   * // Assumes {@link initialiseApp|SAFEApp} interface has been obtained
   *
   * const asyncFn = async () => {
   *   try {
   *     const app = await safe.initialiseApp(appInfo);
   *     const authReqUri = await app.auth.genAuthUri({});
   *     await app.auth.openUri(authReqUri);
   *     // After URI is opened by SAFE Authenticator and authorised,
   *     // this snippet assumes that your application has an
   *     // IPC strategy to receive returned authorisation uri.
   *     await app.auth.loginFromUri(authUri);
   *   } catch (err) {
   *     throw err;
   *   }
   * };
   */
  loginFromUri(uri) {
    if (!uri) throw makeError(errConst.MISSING_AUTH_URI.code, errConst.MISSING_AUTH_URI.msg);
    const sanitisedUri = removeSafeProtocol(uri);
    return lib.decode_ipc_msg(sanitisedUri).then((resp) => {
      const ipcMsgType = resp[0];
      // we handle 'granted', 'unregistered', 'containers' and 'share_mdata' types
      switch (ipcMsgType) {
        case 'unregistered': {
          this._registered = false;
          return lib.app_unregistered(this.app, resp[1]);
        }
        case 'granted': {
          const authGranted = resp[1];
          this._registered = true;
          return lib.app_registered(this.app, authGranted);
            // TODO: in the future: automatically refresh permissions
            //  .then((app) => this.refreshContainersPermissions()
            //    .then(() => app)
            //  );
        }
        case 'containers':
          this._registered = true;
          return Promise.resolve(this.app);
          // TODO: in the future: automatically refresh permissions
          //  return this.refreshContainersPermissions();
        case 'share_mdata':
          this._registered = true;
          return Promise.resolve(this.app);
        default:
          return Promise.reject(resp);
      }
    });
  }

  /**
  * *ONLY AVAILALBE IF RUN in NODE_ENV='test' OR WITH 'forceUseMock' option*
  *
  * Generate a _locally_ registered SAFEApp with the given permissions, or
  * a local unregistered SAFEApp if permissions is `null`.
  * @returns {Promise&lt;SAFEApp>}
  */
  loginForTest(access, opts) {
    if (!useMockByDefault &amp;&amp; !this.app.options.forceUseMock) {
      throw makeError(errConst.NON_DEV.code, errConst.NON_DEV.msg);
    }
    if (access) {
      const appInfo = makeAppInfo(this.app.appInfo);
      const perms = makePermissions(access);
      const authReq = new types.AuthReq({
        app: appInfo,
        app_container: !!(opts &amp;&amp; opts.own_container),
        containers: perms,
        containers_len: perms.length,
        containers_cap: perms.length
      });
      return lib.test_create_app_with_access(authReq.ref())
        .then((appPtr) => {
          this.app.connection = appPtr;
          this._registered = true;
          return this.app;
        });
    }

    return lib.test_create_app(this.app.appInfo.id)
      .then((appPtr) => {
        this.app.connection = appPtr;
        this._registered = false;
        return this.app;
      });
  }

  /**
  * *ONLY AVAILALBE IF RUN in NODE_ENV='test' OR WITH 'forceUseMock' option*
  *
  * Simulates a network disconnection event. This can be used to
  * test any logic to be executed by an application when a network
  * diconnection notification is received.
  * @throws {NON_DEV}
  * @returns {Promise}
  */
  simulateNetworkDisconnect() {
    if (!useMockByDefault &amp;&amp; !this.app.options.forceUseMock) {
      throw makeError(errConst.NON_DEV.code, errConst.NON_DEV.msg);
    }
    return lib.test_simulate_network_disconnect(this.app.connection);
  }
}

module.exports = AuthInterface;
</code></pre>
  </article>
</section>

    


  </div>

  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
  </footer>

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>

  

</body>
</html>
